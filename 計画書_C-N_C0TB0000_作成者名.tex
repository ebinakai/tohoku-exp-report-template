\documentclass[lualatex,ja=standard]{bxjsarticle}

\setpagelayout{noheadfoot,top=1cm,bottom=1cm,left=2cm,right=2cm}
\setlength{\footskip}{6mm}

% パッケージ類
\usepackage{graphicx}   % 画像を挿入するため
\usepackage{amsmath}    % 数式を使うため
\usepackage{amssymb}    % 数式を使うため
\usepackage{caption}    % 図表のキャプション
\usepackage{subcaption} % サブキャプション
\usepackage{siunitx}    % 数式の設定
\usepackage{booktabs}   % 表のスタイル
\usepackage{multirow}   % 表のスタイル
\usepackage{pdfpages}   % 表紙の挿入
\usepackage{enumitem}   % 箇条書き
\usepackage{titlesec}   % セクションのスタイル
\usepackage{luatexja-fontspec} % フォント設定
\usepackage{hyperref}   % 図表へのリンク
\usepackage{xspace}     % スタイルの装飾
\usepackage{makecell}   % 表のセルを結合するため
\usepackage{ascmac}     % 図の枠を作成するため
\usepackage{listings}   % ソースコードの表示
\usepackage{titling}    % タイトルページのカスタマイズ

% タイトル情報（必要に応じて編集）
\title{実験レポートタイトル}
\author{作成者名}
\date{\today}

% フォント
\setmainjfont{IPAexMincho} 
\AtBeginDocument{%
  \fontsize{10.5pt}{16pt}\selectfont
}

% 樹形図
\usepackage{tikz}
\usetikzlibrary{graphs, graphdrawing, arrows.meta, calc}
\usegdlibrary{trees}  % trees 用ライブラリ

% セクションスタイル
\newcommand{\mysectionstyle}[2]{%
  \sffamily         % 欧文・数字→サンセリフ
  \gtfamily         % 日本語→ゴシック
  \bfseries
  \fontsize{#1}{#2}\selectfont
}

% セクションのスタイル
\titleformat{\section}
  {\mysectionstyle{12pt}{16pt}}
  {\mysectionstyle{12pt}{16pt}\thesection.}
  {0.7em}{}
\titlespacing*{\section}{0em}{1em}{0em}

% サブセクションのスタイル
\titleformat{\subsection}
  {\mysectionstyle{10.5pt}{16pt}}
  {\mysectionstyle{10.5pt}{16pt}\thesubsection.}
  {0.7em}{}
\titlespacing*{\subsection}{0em}{0.5em}{0em}

% サブサブセクションのスタイル
\titleformat{\subsubsection}
  {\mysectionstyle{10.5pt}{12pt}}
  {\mysectionstyle{10.5pt}{12pt}\thesubsubsection.}
  {0em}{}
\titlespacing*{\subsubsection}{0em}{0.5em}{0em}

% パラグラフのスタイル
\titleformat{\paragraph}
  {\mysectionstyle{10.5pt}{12pt}}
  {\mysectionstyle{10.5pt}{12pt}\theparagraph.} 
  {0em}{}
\titlespacing*{\paragraph}{0em}{0em}{0em}

% サブパラグラフのスタイル
\titleformat{\subparagraph}
  {\mysectionstyle{8pt}{12pt}}
  {\mysectionstyle{8pt}{12pt}\thesubparagraph.}
  {0em}{}
\titlespacing*{\subparagraph}{0em}{0em}{0em}

% 和文キャプション
\renewcommand{\figurename}{図}
\renewcommand{\tablename}{表}
\renewcommand{\refname}{参考文献}
\renewcommand{\lstlistingname}{ソースコード}

% autoref の和文化
\renewcommand*{\figureautorefname}{図}
\renewcommand*{\tableautorefname}{表}
\renewcommand*{\equationautorefname}{式}
\renewcommand*{\subfigureautorefname}{図}

\captionsetup[subfigure]{labelformat=simple}
\renewcommand*{\thesubfigure}{(\alph{subfigure})}

\captionsetup[subtable]{labelformat=simple}
\renewcommand*{\thesubtable}{(\alph{subtable})}

% 単位の設定
\sisetup{
  detect-all,
  per-mode = symbol,
  range-phrase = --,
}
\NewDocumentCommand{\sibr}{m}{\,\text{[\si{#1}]}} 

% ソースコード用の設定
\lstset{
  basicstyle={\ttfamily},
  identifierstyle={\small},
  commentstyle={\small\itshape},
  keywordstyle={\small\bfseries},
  ndkeywordstyle={\small},
  stringstyle={\small\ttfamily},
  frame={tb},
  breaklines=true,
  columns=[l]{fullflexible},
  numbers=left,
  xrightmargin=0em,
  xleftmargin=3em,
  numbersep=1em,
  numberstyle={\scriptsize},
  stepnumber=1,
  lineskip=-0.5ex
}

% リンクの色設定
\hypersetup{
  colorlinks=true,
  linkcolor=black,
  citecolor=black,
  urlcolor=black
}

% 参考文献の設定
\usepackage[backend=biber,style=numeric,sorting=none]{biblatex}
\addbibresource{refs.bib}

% 参考文献の書式設定
\DeclareDelimFormat{multinamedelim}{，}
\DeclareDelimFormat{finalnamedelim}{，}
\DeclareDelimFormat{nameyeardelim}{，}
\DeclareFieldFormat{title}{#1}
\DeclareFieldFormat{journaltitle}{#1}
\renewcommand*{\newunitpunct}{，}
\DeclareCiteCommand{\cite}
  {\usebibmacro{prenote}}
  {\mkbibsuperscript{[\printfield{labelnumber}]}}
  {\multicitedelim}
  {\usebibmacro{postnote}}

% 書籍フォーマット
\DeclareBibliographyDriver{book}{%
  \printnames{author}：%
  \printfield{title}，%
  \printfield{pages}，%
  \printlist{publisher} (\printfield{year})%
  \finentry
}

% 雑誌論文フォーマット
\DeclareBibliographyDriver{article}{%
  \printnames{author}：%
  \printfield{title}，%
  \printfield{journaltitle}，%
  Vol.\printfield{volume}，%
  \printfield{pages}(\printfield{year})%
  \finentry
}

% 段落設定
\setlength{\parskip}{0.5em}
\setlength{\parindent}{1em}
\makeatletter
\AtBeginDocument{
  \let\@afterindentfalse\@afterindenttrue
}
\makeatother

\begin{document}

\begin{titlepage}
  \noindent
  \begin{center}

    \fontsize{18pt}{18pt}\selectfont
    学生実験C レポート
  \end{center}

  \vspace{0.8cm}

  \fontsize{10.5pt}{10.5pt}\selectfont
  \underline{\makebox[0.96\textwidth][l]{実験題目 : \thetitle}}

  \vspace{0.8cm}

  \fontsize{10.5pt}{10.5pt}\selectfont
  \underline{\makebox[0.45\textwidth][l]{学籍番号 : }}
  \hspace{0.04\textwidth}
  \underline{\makebox[0.45\textwidth][l]{氏名 : }}

  \vspace{0.8cm}

  \fontsize{10.5pt}{10.5pt}\selectfont
  \underline{\makebox[0.2\textwidth][r]{ \hspace{0.2cm} コース}}
  \hspace{0.1\textwidth}
  \underline{\makebox[0.2\textwidth][r]{ \hspace{1cm}班}}
  \hspace{0.1\textwidth}
  \underline{\makebox[0.34\textwidth][l]{提出日 \today}}

  \vspace{0.8cm}

  \fontsize{10.5pt}{10.5pt}\selectfont
  \underline{\makebox[0.4\textwidth][l]{共同実験者名 : }}
  \hspace{0.04\textwidth}
  \underline{\makebox[0.22\textwidth][c]{}}
  \hspace{0.04\textwidth}
  \underline{\makebox[0.22\textwidth][c]{}}

  \vspace{0.8cm}

  \fontsize{10.5pt}{10.5pt}\selectfont
  \begin{center}
    \textgt{チェックリスト（チェックした項目の□を\checkmark に変えながら，確認すること）}
  \end{center}

  \fontsize{10.5pt}{13.5pt}\selectfont
  \textgt{書 \space 式}
  \begin{description}
    \setlength{\parskip}{0.1cm}
    \setlength{\itemsep}{0.1cm}
    \item[\hspace{0.7cm}\checkmark]  グラフ，プログラムリスト，表，写真以外の部分は丁寧に書かれているか．
    \item[\hspace{0.7cm}\checkmark]  実験計画書，目的，概要(原理・方法)，結果，考察，まとめ，参考文献の順にまとめているか.
    \item[\hspace{0.7cm}\checkmark]  実験指針を丸写しせず，自分の言葉も含めてまとめてあるか．
    \item[\hspace{0.7cm}\checkmark]  実験結果，および考察（検討）は過去形で記してあるか．また，普遍的な内容は現在形で記してあるか．
    \item[\hspace{0.7cm}\checkmark]  実験指針に記載されている考察の項目にすべて回答しているか．
    \item[\hspace{0.7cm}\checkmark]  引用箇所を明示し，参考文献リストと対応づけているか．
    \item[\hspace{0.7cm}\checkmark]  参考文献リストは，以下のフォーマットで記してあるか．
      \begin{description}
        \setlength{\parskip}{0.05cm}
        \setlength{\itemsep}{0.05cm}
        \fontsize{10pt}{14pt}\selectfont
        \item[\hspace{0.4cm}○] 論文誌などを引用する場合：

        \fontsize{9pt}{12pt}\selectfont
        [1] 著者名，"標題，"　雑誌名，巻，号，pp.を付けて始め－終りのページ，月年．

        \fontsize{10pt}{14pt}\selectfont
        \item[\hspace{0.4cm}○] 著書，編書を引用する場合：
        
        \fontsize{9pt}{12pt}\selectfont
        [2] 著者名，書名，編者名，発行所，発行年．

        \fontsize{10pt}{14pt}\selectfont
        \item[\hspace{0.4cm}○] 著書の一部を引用する場合：　
        
        \fontsize{9pt}{12pt}\selectfont
        [3] 著者名，"標題，" 書名，編者名，章番号またはpp.を付けて始め－終りのページ，発行所，発行年．
      \end{description}
  \end{description}

  \textgt{図 \space ・ \space 表}
  \begin{description}
    \setlength{\parskip}{0.1cm}
    \setlength{\itemsep}{0.1cm}
    \item[\hspace{0.7cm}\checkmark]  グラフには横軸，縦軸のラベル（変数名と単位）を記しているか．
    \item[\hspace{0.7cm}\checkmark]  横向きのグラフがある場合，グラフの上側が綴じしろ側になるように描いているか
    \item[\hspace{0.7cm}\checkmark]  図や表には，図１，表１のような番号づけをしているか．
    \item[\hspace{0.7cm}\checkmark]  「単位」が正しくSI単位系で記載されているか．
    \item[\hspace{0.7cm}\checkmark]  図の説明文は図の下側に，表の説明文は表の上側に記しているか．
    \item[\hspace{0.7cm}\checkmark]  グラフの表現方法は適切か（不適切な曲線補間をしていないか，グラフと記録条件の対応がわかるようにしてあるか等）．
    \item[\hspace{0.7cm}\checkmark]  本文で図や表について説明をしているか．
  \end{description}
\end{titlepage}

\section{実験の目的}
本実験の目的をここに記述する．

\section{原理}
実験の理論的背景を簡潔に記述する．樹形図は\autoref{fig:tree-diagram}のように作成する．ChatGPTを使用して作成すると良い．

\begin{figure}[htbp]
  \centering
  % 必要に応じてTikZ図を編集または削除
  \begin{tikzpicture}[font=\normalsize, node distance=3cm and 2cm, every node/.style={draw=none, anchor=west}, >={Latex}]
    \node (root) at (0,0) {現象A};
    \node (child1) at ($(root)+(4,0.5)$) {要因1};
    \node (child2) at ($(root)+(4,-0.5)$) {要因2};
    \draw[->] (root.east) -- (child1.west);
    \draw[->] (root.east) -- (child2.west);
  \end{tikzpicture}
  \caption{現象の分類例}
  \label{fig:tree-diagram}
\end{figure}

\section{実験の方法}

\subsection*{[使用器具]}

\begin{itemize}
  \item 使用器具1
\end{itemize}

\subsection{実験概要}
ここに全体の手順や測定方法の概要を記述する．

\subsection{個別手順}
\subsubsection*{[手順例]}
\begin{enumerate}
  \item 装置の初期設定
  \item 測定値の取得
  \item 注意点や補足説明（\textbf{安全注意}など）
\end{enumerate}

\section{実験結果}

\begin{table}[htbp]
  \centering
  \caption{測定結果の例}
  \label{tab:example}
  \begin{tabular}{cccc}
    \toprule
    条件1 & 条件2 & 条件3 & 条件4 \\
    \midrule
    値1 & 値2 & 値3 & 値4 \\
    \bottomrule
  \end{tabular}
\end{table}

\begin{equation}
  y = a x + b \sibr{\meter\per\second}
  \label{eq:line}
\end{equation}
\autoref{eq:line}は測定結果の線形関係を表す．

作成したプログラムも\autoref{lst:python-example}のように表示可能．

\begin{lstlisting}[language=Python, caption=Pythonの例, label=lst:python-example]
  print("Hello, World!")

  def add(a, b):
      return a + b
  result = add(1, 2)
  print("Result:", result)
\end{lstlisting}

画像の挿入例は\autoref{fig:example}の通り．

\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.5\textwidth]{img/CN/graph.png}
  \caption{画像の例}
  \label{fig:example}
\end{figure}

\section{考察}
実験結果に基づいて考察を記述する．たとえば，傾向の説明，理論との一致・不一致，実験誤差の要因などを検討する．

このように参考文献の明示もできる\cite{nist811-si-guide}．

\section{結論}
実験全体の要点を簡潔にまとめる．たとえば，
\begin{itemize}
  \item 結果から得られる一般的な知見
  \item 今後の課題や応用可能性
\end{itemize}

\printbibliography[title=＜参考文献＞]

\end{document}
